% fonts and typography
% alleviate some of the warnings regarding font size
\usepackage{anyfontsize}
\setmainfont[Numbers=OldStyle]{Minion Pro}
\setsansfont[Scale=MatchLowercase]{Optima}
\setmonofont[Scale=MatchLowercase]{Hack}

\unimathsetup{math-style=ISO, partial=upright, nabla=upright}
\setmathfont{Asana Math}

\usepackage[final,protrusion={true,compatibility}]{microtype}
% disable orphaned lines
\clubpenalty=10000
\displaywidowpenalty=10000
\widowpenalty=10000
\tolerance1414
\hbadness1414
\emergencystretch1.5em
\hfuzz0.3pt
\vfuzz0.3pt
\raggedbottom

% fix weird apostrophe spacing with minion
\makeatletter
\XeTeXinterchartokenstate=1

\newXeTeXintercharclass\LetterClass
\@tempcnta=`\A
\loop\unless\ifnum\@tempcnta>`\Z
\XeTeXcharclass \@tempcnta \LetterClass
\advance \@tempcnta by 1
\repeat
\@tempcnta=`\a
\loop\unless\ifnum\@tempcnta>`\z
\XeTeXcharclass \@tempcnta \LetterClass
\advance \@tempcnta by 1
\repeat

\newXeTeXintercharclass\ApostropheClass
\XeTeXcharclass `â€™ \ApostropheClass
\XeTeXcharclass `' \ApostropheClass
\XeTeXinterchartoks \LetterClass \ApostropheClass = {\kern.1ex }
\XeTeXinterchartoks \ApostropheClass \LetterClass = {\kern.1ex }

\makeatother

% allow linebreaks in links at any alphanumerical character
\usepackage{xurl}

\makeatletter
\renewcommand{\@makefntext}[1]{%
  \setlength{\parindent}{0pt}
  \begin{list}{}{%
      \setlength{\topsep}{0pt}
      \setlength{\partopsep}{0pt}
      \setlength{\labelwidth}{.5em} % Space from number to border
      \setlength{\labelsep}{0.3em} % Space from number to text
      \setlength{\leftmargin}{\labelwidth}
      \addtolength{\leftmargin}{\labelsep}
      \footnotesize}\item[{\makebox[\labelwidth][r]{\@makefnmark}}]#1%
  \end{list}
}
\makeatother
